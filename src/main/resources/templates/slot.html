<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishing Frenzy Slot Machine - Epic Gambling By IC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0f4c75, #1e3c72, #2a5298);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .navbar {
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem 0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
        }

        .main-content {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .game-container {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 3px solid #ffd700;
        }

        .game-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .game-title {
            font-size: 2.5rem;
            color: #ffd700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-subtitle {
            font-size: 1.2rem;
            color: #87ceeb;
            margin-bottom: 1rem;
        }

        .balance-display {
            background: linear-gradient(45deg, #2c5530, #3d7c47);
            padding: 1rem 2rem;
            border-radius: 15px;
            display: inline-block;
            font-size: 1.3rem;
            font-weight: bold;
            border: 2px solid #4caf50;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-right: 1rem;
        }

        .free-spins-display {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            padding: 1rem 2rem;
            border-radius: 15px;
            display: inline-block;
            font-size: 1.3rem;
            font-weight: bold;
            border: 2px solid #ff6b6b;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }

        .slot-machine {
            background: linear-gradient(145deg, #2c1810, #3d2817);
            border: 5px solid #8b4513;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .reels-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .reel {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 1rem;
            min-width: 120px;
            min-height: 360px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .reel-symbol {
            font-size: 3rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            min-width: 80px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transition: all 0.3s ease;
        }

        .reel-symbol.winning {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.2); }
        }

        .betting-area {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #ffd700;
        }

        .bet-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .bet-amount {
            background: linear-gradient(45deg, #2c5530, #3d7c47);
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            border: 2px solid #4caf50;
            min-width: 120px;
            text-align: center;
        }

        .bet-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .chip {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .chip:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .chip-5 { background: linear-gradient(45deg, #ff6b6b, #ee5a52); }
        .chip-10 { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .chip-25 { background: linear-gradient(45deg, #45b7d1, #96c93d); }
        .chip-50 { background: linear-gradient(45deg, #f9ca24, #f0932b); }
        .chip-100 { background: linear-gradient(45deg, #6c5ce7, #a29bfe); }
        .chip-500 { background: linear-gradient(45deg, #fd79a8, #e84393); }

        .game-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-spin {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            font-size: 1.3rem;
            padding: 1.2rem 3rem;
        }

        .btn-spin:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(238, 90, 82, 0.4);
        }

        .btn-bet {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .btn-bet:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(68, 160, 141, 0.4);
        }

        .btn-reset {
            background: linear-gradient(45deg, #f9ca24, #f0932b);
            color: #000;
        }

        .btn-reset:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(240, 147, 43, 0.4);
        }

        .btn-auto {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
        }

        .btn-auto:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
        }

        .btn-auto.active {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            animation: pulse 1s infinite;
        }

        .game-status {
            text-align: center;
            font-size: 1.2rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            font-size: 1.2rem;
            color: #ffd700;
            margin: 1rem 0;
        }

        .error {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
            font-weight: bold;
        }

        .winning-message {
            background: linear-gradient(45deg, #4caf50, #45b7d1);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            animation: celebrate 2s infinite;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .paytable {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .paytable h3 {
            color: #ffd700;
            margin-bottom: 1rem;
            text-align: center;
        }

        .paytable-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .paytable-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .symbol {
            font-size: 1.5rem;
        }

        .multiplier {
            color: #ffd700;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .reels-container {
                flex-direction: column;
                align-items: center;
            }
            
            .reel {
                min-width: 100px;
                min-height: 300px;
            }
            
            .reel-symbol {
                font-size: 2.5rem;
                min-width: 60px;
                min-height: 60px;
            }
            
            .bet-controls {
                flex-direction: column;
            }
            
            .game-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="logo">ğŸ° Epic Gambling By IC</a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/blackjack">Blackjack</a></li>
                <li><a href="/slot" class="active">Fishing Frenzy</a></li>
            </ul>
        </div>
    </nav>

    <div class="main-content">
        <div class="game-container">
            <div class="game-header">
                <h1 class="game-title">ğŸ£ Fishing Frenzy Slot Machine</h1>
                <p class="game-subtitle">Cast your line and reel in the big wins!</p>
                <div class="balance-display">
                    Balance: $<span id="balance">1000</span>
                </div>
                <div class="free-spins-display" id="free-spins-display" style="display: none;">
                    ğŸ° Free Spins: <span id="free-spins-count">0</span>
                </div>
            </div>

            <div class="slot-machine">
                <div class="reels-container">
                    <div class="reel" id="reel1">
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                    </div>
                    <div class="reel" id="reel2">
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                    </div>
                    <div class="reel" id="reel3">
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                    </div>
                    <div class="reel" id="reel4">
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                    </div>
                    <div class="reel" id="reel5">
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                        <div class="reel-symbol">ğŸ°</div>
                    </div>
                </div>
            </div>

            <div class="betting-area">
                <div class="bet-controls">
                    <div class="bet-amount">
                        Bet: $<span id="bet-amount">0</span>
                    </div>
                    <div class="bet-chips">
                        <div class="chip chip-5" onclick="addBet(5)">$5</div>
                        <div class="chip chip-10" onclick="addBet(10)">$10</div>
                        <div class="chip chip-25" onclick="addBet(25)">$25</div>
                        <div class="chip chip-50" onclick="addBet(50)">$50</div>
                        <div class="chip chip-100" onclick="addBet(100)">$100</div>
                        <div class="chip chip-500" onclick="addBet(500)">$500</div>
                    </div>
                </div>
                
                <div class="game-buttons">
                    <button class="btn btn-bet" onclick="clearBet()">Clear Bet</button>
                    <button class="btn btn-spin" id="spin-btn" onclick="spin()" disabled>ğŸ£ SPIN</button>
                    <button class="btn btn-auto" id="auto-spin-btn" onclick="toggleAutoSpin()" disabled>ğŸ”„ AUTO SPIN</button>
                </div>
            </div>

            <div class="game-status" id="game-status">
                ğŸ° Place your bet and click SPIN to start fishing!
            </div>

            <div class="loading" id="loading">
                ğŸ£ Reeling in your catch...
            </div>

            <div class="paytable">
                <h3>ğŸ£ Paytable - Fishing Frenzy (5 Reels)</h3>
                <div class="paytable-grid">
                    <div class="paytable-item">
                        <span class="symbol">ğŸŸğŸŸğŸŸğŸŸğŸŸ</span>
                        <span class="multiplier">2x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆğŸ¦ˆ</span>
                        <span class="multiplier">4x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ ğŸ ğŸ ğŸ ğŸ </span>
                        <span class="multiplier">6x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ¦‘ğŸ¦‘ğŸ¦‘ğŸ¦‘ğŸ¦‘</span>
                        <span class="multiplier">8x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ¦€ğŸ¦€ğŸ¦€ğŸ¦€ğŸ¦€</span>
                        <span class="multiplier">10x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ™ğŸ™ğŸ™ğŸ™ğŸ™</span>
                        <span class="multiplier">12x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">âš“âš“âš“âš“âš“</span>
                        <span class="multiplier">16x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ’ğŸ’ğŸ’ğŸ’ğŸ’</span>
                        <span class="multiplier">20x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ£ğŸ£ğŸ£ğŸ£ğŸ£</span>
                        <span class="multiplier">30x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ’°ğŸ’°ğŸ’°ğŸ’°ğŸ’°</span>
                        <span class="multiplier">50x</span>
                    </div>
                    <div class="paytable-item">
                        <span class="symbol">ğŸ°ğŸ°ğŸ° (3+)</span>
                        <span class="multiplier">10 Free Spins!</span>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 1rem; color: #87ceeb;">
                    4-reel matches pay 1x, 3-reel matches pay 0.5x<br>
                    Get 3+ free spins symbols (ğŸ°) to trigger 10 free spins!
                </p>
            </div>
        </div>
    </div>

    <script>
        let gameState = null;
        let playerBalance = 1000;
        let currentBet = 0;
        let autoSpinActive = false;
        let autoSpinInterval = null;

        // Get balance from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const balanceParam = urlParams.get('balance');
        if (balanceParam) {
            playerBalance = parseInt(balanceParam);
        }

        async function makeApiCall(endpoint, method = 'GET', data = null) {
            try {
                console.log('Making API call to:', `/slot${endpoint}`, 'Method:', method);
                showLoading();
                
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(`/slot${endpoint}`, options);
                console.log('Response status:', response.status);
                const result = await response.json();
                console.log('API Response:', result);
                
                hideLoading();
                
                if (result.success) {
                    gameState = result.data;
                    updateGameDisplay();
                } else {
                    showError(result.message);
                }
            } catch (error) {
                console.error('API Error:', error);
                hideLoading();
                showError('Network error: ' + error.message);
            }
        }

        function updateGameDisplay() {
            if (!gameState) return;

            // Update balance
            playerBalance = gameState.playerBalance;
            currentBet = gameState.currentBet;
            
            document.getElementById('balance').textContent = playerBalance;
            document.getElementById('bet-amount').textContent = currentBet;

            // Update free spins display
            const freeSpinsDisplay = document.getElementById('free-spins-display');
            const freeSpinsCount = document.getElementById('free-spins-count');
            if (gameState.freeSpinsRemaining > 0) {
                freeSpinsDisplay.style.display = 'inline-block';
                freeSpinsCount.textContent = gameState.freeSpinsRemaining;
            } else {
                freeSpinsDisplay.style.display = 'none';
            }

            // Update reels
            if (gameState.reel1 && gameState.reel2 && gameState.reel3 && gameState.reel4 && gameState.reel5) {
                updateReels(gameState.reel1, gameState.reel2, gameState.reel3, gameState.reel4, gameState.reel5);
            }

            // Update status message
            const statusDiv = document.getElementById('game-status');
            statusDiv.textContent = gameState.message || 'ğŸ° Place your bet and click SPIN!';
            
            if (gameState.totalWinnings > 0) {
                statusDiv.className = 'winning-message';
                // Auto-reset after showing win
                setTimeout(() => {
                    resetGameState();
                }, 3000);
            } else if (gameState.roundOver) {
                statusDiv.className = 'game-status';
                // Auto-reset after showing result
                setTimeout(() => {
                    resetGameState();
                }, 2000);
            } else {
                statusDiv.className = 'game-status';
            }

            // Update button states
            updateButtonStates();
        }

        function updateReels(reel1, reel2, reel3, reel4, reel5) {
            const reels = [reel1, reel2, reel3, reel4, reel5];
            
            for (let i = 0; i < 5; i++) {
                const reelElement = document.getElementById(`reel${i + 1}`);
                const symbols = reelElement.querySelectorAll('.reel-symbol');
                
                for (let j = 0; j < 3; j++) {
                    symbols[j].textContent = reels[i][j];
                    symbols[j].classList.remove('winning');
                }
            }
            
            // Check for winning combinations and highlight them
            checkWinningCombinations(reel1, reel2, reel3, reel4, reel5);
        }

        function checkWinningCombinations(reel1, reel2, reel3, reel4, reel5) {
            // Check 5-reel horizontal wins
            for (let row = 0; row < 3; row++) {
                if (reel1[row] === reel2[row] && reel2[row] === reel3[row] && 
                    reel3[row] === reel4[row] && reel4[row] === reel5[row]) {
                    highlightWin5Reel(reel1[row], row);
                }
            }
            
            // Check 4-reel horizontal wins
            for (let row = 0; row < 3; row++) {
                if (reel1[row] === reel2[row] && reel2[row] === reel3[row] && reel3[row] === reel4[row]) {
                    highlightWin4Reel(reel1[row], row, 0);
                }
                if (reel2[row] === reel3[row] && reel3[row] === reel4[row] && reel4[row] === reel5[row]) {
                    highlightWin4Reel(reel2[row], row, 1);
                }
            }
            
            // Check 3-reel horizontal wins
            for (let row = 0; row < 3; row++) {
                if (reel1[row] === reel2[row] && reel2[row] === reel3[row]) {
                    highlightWin3Reel(reel1[row], row, 0);
                }
                if (reel2[row] === reel3[row] && reel3[row] === reel4[row]) {
                    highlightWin3Reel(reel2[row], row, 1);
                }
                if (reel3[row] === reel4[row] && reel4[row] === reel5[row]) {
                    highlightWin3Reel(reel3[row], row, 2);
                }
            }
            
            // Check diagonal wins
            if (reel1[0] === reel2[1] && reel2[1] === reel3[2] && 
                reel3[2] === reel4[1] && reel4[1] === reel5[0]) {
                highlightDiagonalWin5Reel(0, 1, 2, 1, 0);
            }
            
            if (reel1[2] === reel2[1] && reel2[1] === reel3[0] && 
                reel3[0] === reel4[1] && reel4[1] === reel5[2]) {
                highlightDiagonalWin5Reel(2, 1, 0, 1, 2);
            }
        }

        function highlightWin5Reel(symbol, row) {
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3'), 
                          document.getElementById('reel4'), document.getElementById('reel5')];
            reels.forEach(reel => {
                const symbols = reel.querySelectorAll('.reel-symbol');
                symbols[row].classList.add('winning');
            });
        }

        function highlightWin4Reel(symbol, row, startReel) {
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3'), 
                          document.getElementById('reel4'), document.getElementById('reel5')];
            for (let i = startReel; i < startReel + 4; i++) {
                const symbols = reels[i].querySelectorAll('.reel-symbol');
                symbols[row].classList.add('winning');
            }
        }

        function highlightWin3Reel(symbol, row, startReel) {
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3'), 
                          document.getElementById('reel4'), document.getElementById('reel5')];
            for (let i = startReel; i < startReel + 3; i++) {
                const symbols = reels[i].querySelectorAll('.reel-symbol');
                symbols[row].classList.add('winning');
            }
        }

        function highlightDiagonalWin5Reel(pos1, pos2, pos3, pos4, pos5) {
            const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3'), 
                          document.getElementById('reel4'), document.getElementById('reel5')];
            const positions = [pos1, pos2, pos3, pos4, pos5];
            
            reels.forEach((reel, index) => {
                const symbols = reel.querySelectorAll('.reel-symbol');
                symbols[positions[index]].classList.add('winning');
            });
        }

        function updateButtonStates() {
            const spinBtn = document.getElementById('spin-btn');
            const autoBtn = document.getElementById('auto-spin-btn');
            console.log('Updating button states - currentBet:', currentBet, 'gameState:', gameState);
            
            // Enable spin button if we have a bet and either no game state or game is not started or round is over
            if (currentBet > 0) {
                if (!gameState || !gameState.gameStarted || gameState.roundOver) {
                    spinBtn.disabled = false;
                    autoBtn.disabled = false;
                    console.log('Buttons enabled - has bet and game ready');
                } else {
                    spinBtn.disabled = true;
                    autoBtn.disabled = true;
                    console.log('Buttons disabled - game in progress');
                }
            } else {
                spinBtn.disabled = true;
                autoBtn.disabled = true;
                console.log('Buttons disabled - no bet placed');
            }
        }

        function resetGameState() {
            // Stop auto-spin if active
            if (autoSpinActive) {
                stopAutoSpin();
            }
            
            // Reset the frontend game state without API call
            gameState = null;
            currentBet = 0;
            updateBetDisplay();
            updateButtonStates();
            
            // Clear the reels
            for (let i = 1; i <= 5; i++) {
                const reelElement = document.getElementById(`reel${i}`);
                const symbols = reelElement.querySelectorAll('.reel-symbol');
                symbols.forEach(symbol => {
                    symbol.textContent = 'ğŸ°';
                    symbol.classList.remove('winning');
                });
            }
            
            // Hide free spins display
            document.getElementById('free-spins-display').style.display = 'none';
            
            // Update status
            document.getElementById('game-status').textContent = 'ğŸ° Place your bet and click SPIN!';
            document.getElementById('game-status').className = 'game-status';
        }

        function addBet(amount) {
            console.log('Adding bet:', amount, 'Current bet:', currentBet, 'Balance:', playerBalance);
            
            if (currentBet + amount <= playerBalance) {
                currentBet += amount;
                updateBetDisplay();
                updateButtonStates();
                console.log('Bet added successfully, new currentBet:', currentBet);
                
                // Show visual feedback
                const betDisplay = document.getElementById('bet-amount');
                betDisplay.style.backgroundColor = '#4caf50';
                betDisplay.style.color = 'white';
                setTimeout(() => {
                    betDisplay.style.backgroundColor = '';
                    betDisplay.style.color = '';
                }, 500);
            } else {
                showError('Insufficient balance!');
            }
        }

        function updateBetDisplay() {
            document.getElementById('bet-amount').textContent = currentBet;
        }

        function clearBet() {
            currentBet = 0;
            updateBetDisplay();
            updateButtonStates();
        }

        async function spin() {
            console.log('Spin button clicked - currentBet:', currentBet, 'playerBalance:', playerBalance);
            
            if (currentBet === 0) {
                showError('Please place a bet first!');
                return;
            }
            
            await makeApiCall('/spin', 'POST');
        }

        function toggleAutoSpin() {
            if (autoSpinActive) {
                stopAutoSpin();
            } else {
                startAutoSpin();
            }
        }

        function startAutoSpin() {
            if (currentBet === 0) {
                showError('Please place a bet first!');
                return;
            }
            
            autoSpinActive = true;
            const autoBtn = document.getElementById('auto-spin-btn');
            autoBtn.textContent = 'â¹ï¸ STOP AUTO';
            autoBtn.classList.add('active');
            
            // Auto spin every 2 seconds
            autoSpinInterval = setInterval(async () => {
                if (autoSpinActive && currentBet > 0) {
                    await makeApiCall('/spin', 'POST');
                } else {
                    stopAutoSpin();
                }
            }, 2000);
            
            console.log('Auto spin started');
        }

        function stopAutoSpin() {
            autoSpinActive = false;
            const autoBtn = document.getElementById('auto-spin-btn');
            autoBtn.textContent = 'ğŸ”„ AUTO SPIN';
            autoBtn.classList.remove('active');
            
            if (autoSpinInterval) {
                clearInterval(autoSpinInterval);
                autoSpinInterval = null;
            }
            
            console.log('Auto spin stopped');
        }


        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const statusDiv = document.getElementById('game-status');
            statusDiv.textContent = 'âŒ ' + message;
            statusDiv.className = 'error';
        }

        // Load initial game state
        window.onload = function() {
            console.log('Page loaded, initializing slot machine');
            updateBetDisplay();
            updateButtonStates();
            makeApiCall('/state');
        };
    </script>
</body>
</html>
